#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

SOURCE_DIR := $(CURDIR)/src/github.com/aptly-dev/aptly
DEST_DIR := $(CURDIR)/debian/aptly
VERSION := $(shell dpkg-parsechangelog -S Version)

%:
	dh $@ --with systemd

override_dh_auto_clean:
	rm -f aptly

override_dh_auto_build:
	cd ${SOURCE_DIR} && go mod download
	cd ${SOURCE_DIR} && GO111MODULE=on GOBIN=$(CURDIR) go install -v -ldflags "-X main.Version=$(VERSION)"

override_dh_auto_install:
	dh_bash-completion
	mkdir -p $(DEST_DIR)/usr/bin
	mv aptly  $(DEST_DIR)/usr/bin/
